qualif Q_AA_LE_ARRAY_LENGTH_DATA(_AA) : _AA <= Array.length data;;
qualif Q_AA_GE_ARRAY_LENGTH_DATA(_AA) : _AA >= Array.length data;;
qualif Q_AA_EQ_ARRAY_LENGTH_DATA(_AA) : _AA = Array.length data;;
qualif Q_AA_NE_ARRAY_LENGTH_DATA(_AA) : _AA != Array.length data;;
qualif QARRAY_LENGTH__AA_LE_ARRAY_LENGTH_DATA(_AA) : Array.length _AA <= Array.length data;;
qualif QARRAY_LENGTH__AA_GE_ARRAY_LENGTH_DATA(_AA) : Array.length _AA >= Array.length data;;
qualif QARRAY_LENGTH__AA_EQ_ARRAY_LENGTH_DATA(_AA) : Array.length _AA = Array.length data;;
qualif QARRAY_LENGTH__AA_NE_ARRAY_LENGTH_DATA(_AA) : Array.length _AA != Array.length data;;
qualif Q_AA_LE_ARRAY_LENGTH_DATA(_AA) : _AA <= Array.length data;;
qualif Q_AA_GE_ARRAY_LENGTH_DATA(_AA) : _AA >= Array.length data;;
qualif Q_AA_EQ_ARRAY_LENGTH_DATA(_AA) : _AA = Array.length data;;
qualif Q_AA_NE_ARRAY_LENGTH_DATA(_AA) : _AA != Array.length data;;
qualif QARRAY_LENGTH__AA_LE_ARRAY_LENGTH_DATA(_AA) : Array.length _AA <= Array.length data;;
qualif QARRAY_LENGTH__AA_GE_ARRAY_LENGTH_DATA(_AA) : Array.length _AA >= Array.length data;;
qualif QARRAY_LENGTH__AA_EQ_ARRAY_LENGTH_DATA(_AA) : Array.length _AA = Array.length data;;
qualif QARRAY_LENGTH__AA_NE_ARRAY_LENGTH_DATA(_AA) : Array.length _AA != Array.length data;;
qualif Q_AA_LE_ARRAY_LENGTH_DATA(_AA) : _AA <= Array.length data;;
qualif Q_AA_GE_ARRAY_LENGTH_DATA(_AA) : _AA >= Array.length data;;
qualif Q_AA_EQ_ARRAY_LENGTH_DATA(_AA) : _AA = Array.length data;;
qualif Q_AA_NE_ARRAY_LENGTH_DATA(_AA) : _AA != Array.length data;;
qualif QARRAY_LENGTH__AA_LE_ARRAY_LENGTH_DATA(_AA) : Array.length _AA <= Array.length data;;
qualif QARRAY_LENGTH__AA_GE_ARRAY_LENGTH_DATA(_AA) : Array.length _AA >= Array.length data;;
qualif QARRAY_LENGTH__AA_EQ_ARRAY_LENGTH_DATA(_AA) : Array.length _AA = Array.length data;;
qualif QARRAY_LENGTH__AA_NE_ARRAY_LENGTH_DATA(_AA) : Array.length _AA != Array.length data;;
qualif Q_AA_LE_ARRAY_LENGTH_DATA(_AA) : _AA <= Array.length data;;
qualif Q_AA_GE_ARRAY_LENGTH_DATA(_AA) : _AA >= Array.length data;;
qualif Q_AA_EQ_ARRAY_LENGTH_DATA(_AA) : _AA = Array.length data;;
qualif Q_AA_NE_ARRAY_LENGTH_DATA(_AA) : _AA != Array.length data;;
qualif QARRAY_LENGTH__AA_LE_ARRAY_LENGTH_DATA(_AA) : Array.length _AA <= Array.length data;;
qualif QARRAY_LENGTH__AA_GE_ARRAY_LENGTH_DATA(_AA) : Array.length _AA >= Array.length data;;
qualif QARRAY_LENGTH__AA_EQ_ARRAY_LENGTH_DATA(_AA) : Array.length _AA = Array.length data;;
qualif QARRAY_LENGTH__AA_NE_ARRAY_LENGTH_DATA(_AA) : Array.length _AA != Array.length data;;
qualif Q_AA_LE_ARRAY_LENGTH_DATA(_AA) : _AA <= Array.length data;;
qualif Q_AA_GE_ARRAY_LENGTH_DATA(_AA) : _AA >= Array.length data;;
qualif Q_AA_EQ_ARRAY_LENGTH_DATA(_AA) : _AA = Array.length data;;
qualif Q_AA_NE_ARRAY_LENGTH_DATA(_AA) : _AA != Array.length data;;
qualif QARRAY_LENGTH__AA_LE_ARRAY_LENGTH_DATA(_AA) : Array.length _AA <= Array.length data;;
qualif QARRAY_LENGTH__AA_GE_ARRAY_LENGTH_DATA(_AA) : Array.length _AA >= Array.length data;;
qualif QARRAY_LENGTH__AA_EQ_ARRAY_LENGTH_DATA(_AA) : Array.length _AA = Array.length data;;
qualif QARRAY_LENGTH__AA_NE_ARRAY_LENGTH_DATA(_AA) : Array.length _AA != Array.length data;;
qualif Q_AA_LE_I'(_AA) : _AA <= i';;
qualif Q_AA_GE_I'(_AA) : _AA >= i';;
qualif Q_AA_EQ_I'(_AA) : _AA = i';;
qualif Q_AA_NE_I'(_AA) : _AA != i';;
qualif Q_AA_LE_DIFF(_AA) : _AA <= diff;;
qualif Q_AA_GE_DIFF(_AA) : _AA >= diff;;
qualif Q_AA_EQ_DIFF(_AA) : _AA = diff;;
qualif Q_AA_NE_DIFF(_AA) : _AA != diff;;
qualif Q_AA_LE_I_16(_AA) : _AA <= i_16;;
qualif Q_AA_GE_I_16(_AA) : _AA >= i_16;;
qualif Q_AA_EQ_I_16(_AA) : _AA = i_16;;
qualif Q_AA_NE_I_16(_AA) : _AA != i_16;;
qualif Q_AA_LE_ISQ(_AA) : _AA <= isq;;
qualif Q_AA_GE_ISQ(_AA) : _AA >= isq;;
qualif Q_AA_EQ_ISQ(_AA) : _AA = isq;;
qualif Q_AA_NE_ISQ(_AA) : _AA != isq;;
qualif Q_AA_LE_I(_AA) : _AA <= i;;
qualif Q_AA_GE_I(_AA) : _AA >= i;;
qualif Q_AA_EQ_I(_AA) : _AA = i;;
qualif Q_AA_NE_I(_AA) : _AA != i;;
qualif Q_AA_LE_MAXX(_AA) : _AA <= maxx;;
qualif Q_AA_GE_MAXX(_AA) : _AA >= maxx;;
qualif Q_AA_EQ_MAXX(_AA) : _AA = maxx;;
qualif Q_AA_NE_MAXX(_AA) : _AA != maxx;;
qualif Q_AA_LE_K'(_AA) : _AA <= k';;
qualif Q_AA_GE_K'(_AA) : _AA >= k';;
qualif Q_AA_EQ_K'(_AA) : _AA = k';;
qualif Q_AA_NE_K'(_AA) : _AA != k';;
qualif Q_AA_LE_K(_AA) : _AA <= k;;
qualif Q_AA_GE_K(_AA) : _AA >= k;;
qualif Q_AA_EQ_K(_AA) : _AA = k;;
qualif Q_AA_NE_K(_AA) : _AA != k;;
qualif Q_AA_LE_J(_AA) : _AA <= j;;
qualif Q_AA_GE_J(_AA) : _AA >= j;;
qualif Q_AA_EQ_J(_AA) : _AA = j;;
qualif Q_AA_NE_J(_AA) : _AA != j;;
qualif Q_AA_LE_I(_AA) : _AA <= i;;
qualif Q_AA_GE_I(_AA) : _AA >= i;;
qualif Q_AA_EQ_I(_AA) : _AA = i;;
qualif Q_AA_NE_I(_AA) : _AA != i;;
qualif Q_AA_LE_MAXX'(_AA) : _AA <= maxx';;
qualif Q_AA_GE_MAXX'(_AA) : _AA >= maxx';;
qualif Q_AA_EQ_MAXX'(_AA) : _AA = maxx';;
qualif Q_AA_NE_MAXX'(_AA) : _AA != maxx';;
qualif Q_AA_LE_I'(_AA) : _AA <= i';;
qualif Q_AA_GE_I'(_AA) : _AA >= i';;
qualif Q_AA_EQ_I'(_AA) : _AA = i';;
qualif Q_AA_NE_I'(_AA) : _AA != i';;
qualif Q_AA_LE_I(_AA) : _AA <= i;;
qualif Q_AA_GE_I(_AA) : _AA >= i;;
qualif Q_AA_EQ_I(_AA) : _AA = i;;
qualif Q_AA_NE_I(_AA) : _AA != i;;
qualif Q_AA_LE_SIZE(_AA) : _AA <= size;;
qualif Q_AA_GE_SIZE(_AA) : _AA >= size;;
qualif Q_AA_EQ_SIZE(_AA) : _AA = size;;
qualif Q_AA_NE_SIZE(_AA) : _AA != size;;
qualif Q_AA_LE_MAXX(_AA) : _AA <= maxx;;
qualif Q_AA_GE_MAXX(_AA) : _AA >= maxx;;
qualif Q_AA_EQ_MAXX(_AA) : _AA = maxx;;
qualif Q_AA_NE_MAXX(_AA) : _AA != maxx;;
qualif Q_AA_LE_SIZE'_1(_AA) : _AA <= size'_1;;
qualif Q_AA_GE_SIZE'_1(_AA) : _AA >= size'_1;;
qualif Q_AA_EQ_SIZE'_1(_AA) : _AA = size'_1;;
qualif Q_AA_NE_SIZE'_1(_AA) : _AA != size'_1;;
qualif Q_AA_LE_SIZE'(_AA) : _AA <= size';;
qualif Q_AA_GE_SIZE'(_AA) : _AA >= size';;
qualif Q_AA_EQ_SIZE'(_AA) : _AA = size';;
qualif Q_AA_NE_SIZE'(_AA) : _AA != size';;
qualif Q_AA_LE_I'(_AA) : _AA <= i';;
qualif Q_AA_GE_I'(_AA) : _AA >= i';;
qualif Q_AA_EQ_I'(_AA) : _AA = i';;
qualif Q_AA_NE_I'(_AA) : _AA != i';;
qualif Q_AA_LE_I(_AA) : _AA <= i;;
qualif Q_AA_GE_I(_AA) : _AA >= i;;
qualif Q_AA_EQ_I(_AA) : _AA = i;;
qualif Q_AA_NE_I(_AA) : _AA != i;;
qualif Q_AA_LE_SIZE(_AA) : _AA <= size;;
qualif Q_AA_GE_SIZE(_AA) : _AA >= size;;
qualif Q_AA_EQ_SIZE(_AA) : _AA = size;;
qualif Q_AA_NE_SIZE(_AA) : _AA != size;;
qualif Q_AA_LE_LARGEST(_AA) : _AA <= largest;;
qualif Q_AA_GE_LARGEST(_AA) : _AA >= largest;;
qualif Q_AA_EQ_LARGEST(_AA) : _AA = largest;;
qualif Q_AA_NE_LARGEST(_AA) : _AA != largest;;
qualif Q_AA_LE_LARGEST(_AA) : _AA <= largest;;
qualif Q_AA_GE_LARGEST(_AA) : _AA >= largest;;
qualif Q_AA_EQ_LARGEST(_AA) : _AA = largest;;
qualif Q_AA_NE_LARGEST(_AA) : _AA != largest;;
qualif Q_AA_LE_RIGHT(_AA) : _AA <= right;;
qualif Q_AA_GE_RIGHT(_AA) : _AA >= right;;
qualif Q_AA_EQ_RIGHT(_AA) : _AA = right;;
qualif Q_AA_NE_RIGHT(_AA) : _AA != right;;
qualif Q_AA_LE_LEFT(_AA) : _AA <= left;;
qualif Q_AA_GE_LEFT(_AA) : _AA >= left;;
qualif Q_AA_EQ_LEFT(_AA) : _AA = left;;
qualif Q_AA_NE_LEFT(_AA) : _AA != left;;
qualif Q_AA_LE_I_2(_AA) : _AA <= i_2;;
qualif Q_AA_GE_I_2(_AA) : _AA >= i_2;;
qualif Q_AA_EQ_I_2(_AA) : _AA = i_2;;
qualif Q_AA_NE_I_2(_AA) : _AA != i_2;;
qualif Q_AA_LE_I_1(_AA) : _AA <= i_1;;
qualif Q_AA_GE_I_1(_AA) : _AA >= i_1;;
qualif Q_AA_EQ_I_1(_AA) : _AA = i_1;;
qualif Q_AA_NE_I_1(_AA) : _AA != i_1;;
qualif Q_AA_LE_I(_AA) : _AA <= i;;
qualif Q_AA_GE_I(_AA) : _AA >= i;;
qualif Q_AA_EQ_I(_AA) : _AA = i;;
qualif Q_AA_NE_I(_AA) : _AA != i;;
qualif Q_AA_LE_SIZE(_AA) : _AA <= size;;
qualif Q_AA_GE_SIZE(_AA) : _AA >= size;;
qualif Q_AA_EQ_SIZE(_AA) : _AA = size;;
qualif Q_AA_NE_SIZE(_AA) : _AA != size;;
qualif Q_AA_LE_5(_AA) : _AA <= 5;;
qualif Q_AA_GE_5(_AA) : _AA >= 5;;
qualif Q_AA_EQ_5(_AA) : _AA = 5;;
qualif Q_AA_NE_5(_AA) : _AA != 5;;
qualif QARRAY_LENGTH__AA_LE_5(_AA) : Array.length _AA <= 5;;
qualif QARRAY_LENGTH__AA_GE_5(_AA) : Array.length _AA >= 5;;
qualif QARRAY_LENGTH__AA_EQ_5(_AA) : Array.length _AA = 5;;
qualif QARRAY_LENGTH__AA_NE_5(_AA) : Array.length _AA != 5;;
qualif Q_AA_LE_16(_AA) : _AA <= 16;;
qualif Q_AA_GE_16(_AA) : _AA >= 16;;
qualif Q_AA_EQ_16(_AA) : _AA = 16;;
qualif Q_AA_NE_16(_AA) : _AA != 16;;
qualif QARRAY_LENGTH__AA_LE_16(_AA) : Array.length _AA <= 16;;
qualif QARRAY_LENGTH__AA_GE_16(_AA) : Array.length _AA >= 16;;
qualif QARRAY_LENGTH__AA_EQ_16(_AA) : Array.length _AA = 16;;
qualif QARRAY_LENGTH__AA_NE_16(_AA) : Array.length _AA != 16;;
qualif Q_AA_LE_0(_AA) : _AA <= 0;;
qualif Q_AA_GE_0(_AA) : _AA >= 0;;
qualif Q_AA_EQ_0(_AA) : _AA = 0;;
qualif Q_AA_NE_0(_AA) : _AA != 0;;
qualif QARRAY_LENGTH__AA_LE_0(_AA) : Array.length _AA <= 0;;
qualif QARRAY_LENGTH__AA_GE_0(_AA) : Array.length _AA >= 0;;
qualif QARRAY_LENGTH__AA_EQ_0(_AA) : Array.length _AA = 0;;
qualif QARRAY_LENGTH__AA_NE_0(_AA) : Array.length _AA != 0;;
qualif Q_AA_LE_2(_AA) : _AA <= 2;;
qualif Q_AA_GE_2(_AA) : _AA >= 2;;
qualif Q_AA_EQ_2(_AA) : _AA = 2;;
qualif Q_AA_NE_2(_AA) : _AA != 2;;
qualif QARRAY_LENGTH__AA_LE_2(_AA) : Array.length _AA <= 2;;
qualif QARRAY_LENGTH__AA_GE_2(_AA) : Array.length _AA >= 2;;
qualif QARRAY_LENGTH__AA_EQ_2(_AA) : Array.length _AA = 2;;
qualif QARRAY_LENGTH__AA_NE_2(_AA) : Array.length _AA != 2;;
qualif Q_AA_LE_1(_AA) : _AA <= 1;;
qualif Q_AA_GE_1(_AA) : _AA >= 1;;
qualif Q_AA_EQ_1(_AA) : _AA = 1;;
qualif Q_AA_NE_1(_AA) : _AA != 1;;
qualif QARRAY_LENGTH__AA_LE_1(_AA) : Array.length _AA <= 1;;
qualif QARRAY_LENGTH__AA_GE_1(_AA) : Array.length _AA >= 1;;
qualif QARRAY_LENGTH__AA_EQ_1(_AA) : Array.length _AA = 1;;
qualif QARRAY_LENGTH__AA_NE_1(_AA) : Array.length _AA != 1;;
(*datatype 'a heap with nat =
  {n:nat} H(n) of int(n) * [a:nat | a <= n] int(a) * 'a array(n)
                  (* maximum size, current size, data *)*)


let rec heapify size data i =
  let i_1 = i + 1 in
  let i_2 = i + 2 in
	let left = 2 * i_1 in
	let right = 2 * i_2 in
	let largest =
	    (if left < size then
		 if Array.get data left > Array.get data i then left else i
	     else i (*: int[0,n)*))
  in
	let largest =
	    (if right < size then
		 if Array.get data right > Array.get data largest then right
		 else largest
	     else largest(*: int[0,n)*))
  in
	if largest > i then
		let temp = Array.get data i in
    let temp2 = Array.get data largest in
		let _none = Array.set data i temp2 in
		let _none = Array.set data largest temp in
	    heapify size data largest
	else ()
(*withtype {n:nat,i:nat | i < n} <n-i> =>
         float heap(n) * int(i) -> unit*)
in

let buildheap size data =
	let rec loop i =
	    if i >= 0 then
		    let _none = heapify size data i in 
        let i' = i - 1 in
        loop i' 
	    else ()
(*withtype {i:int | i < n} <max(i+1,0)> => int(i) -> unit*)
    in
    let size' = size / 2 in
    let size'_1 = size' - 1 in
	  loop size'_1
(*withtype {n:nat} float heap(n) -> unit*)
in

let heapsort maxx size data =
	let  _none = buildheap size data in
	let rec loop i =
	    if i >= 1 then
		    let temp = Array.get data i in
        let gd0 = Array.get data 0 in
		    let _none = Array.set data i gd0 in
		    let _none = Array.set data 0 temp in
		    let _none = heapify i data 0 in
        let i' = i - 1 in
		    loop i'
	    else ()
        (*withtype {i:int | i < n} <max(i,0)> => int(i) -> unit*)
    in
    let maxx' = maxx - 1 in
	loop maxx'
(*withtype {n:nat} float heap(n) -> unit*)
in

let print_array	data i j =
	let rec loop k =
	  if k < j then
      let sdk = Array.get data k in
 	    (*let _none = print_float sdk in*)
      let k' = k + 1 in
      loop k'
    else ()
        (*withtype {k:int | i <= k <= j} <j-k> => int(k) -> unit*)
  in
	loop i
(*withtype {n:nat, i:int, j:int | 0 <= i <= j <= n} <j-i> =>
         float array(n) * int(i) * int(j) -> unit*)
in

let main _none =
	let maxx = 16 in
	let data = Array.make maxx 0 in
    let rec init i =
	    if i < maxx then
        let isq = i * i in
        let i_16 = 16 * i in 
        let diff = i_16 - isq in
		    let _none = Array.set data i diff in
        let i' = i + 1 in
		    init i'
	    else ()
	(*withtype {i:nat} int(i) -> unit*)
  in
	let _none = init 0 in
	heapsort maxx 0 data; print_array data 0 maxx; data
(*withtype <> => unit -> unit*)
in main ();;


(*(*datatype 'a heap with nat =
  {n:nat} H(n) of int(n) * [a:nat | a <= n] int(a) * 'a array(n)
                  (* maximum size, current size, data *)*)

fun heapify (h, i) =
    let
	val H (_, size, data) = h
	val left = 2 * i + 1
	val right = 2 * i + 2
	val largest =
	    (if left < size then
		 if sub (data, left) >. sub (data, i) then left else i
	     else i : int[0,n))
	val largest =
	    (if right < size then
		 if sub (data, right) >. sub (data, largest) then right
		 else largest
	     else largest: int[0,n))
    in
	if largest > i then
	    let
		val temp = sub (data, i)
		val _ = update (data, i, sub (data, largest))
		val _ = update (data, largest, temp)
	    in
	        heapify (h, largest)
	    end
	else ()
    end
(*withtype {n:nat,i:nat | i < n} <n-i> =>
         float heap(n) * int(i) -> unit*)


fun buildheap (h) =
    let
	val H(_, size, data) = h
	fun loop (i) =
	    if i >= 0 then
		let val _ = heapify (h, i) in loop (i - 1) end
	    else ()
(*withtype {i:int | i < n} <max(i+1,0)> => int(i) -> unit*)
    in
	loop (size / 2 - 1)
    end	
(*withtype {n:nat} float heap(n) -> unit*)


fun heapsort (h) =
    let
	val H (max, _, data) = h
	val _ = buildheap (h)
	fun loop (i) =
	    if i >= 1 then
		let
		    val temp = sub (data, i)
		    val _ = update (data, i, sub (data, 0))
		    val _ = update (data, 0, temp)
		    val _ = heapify (H (max, i, data), 0)
		in
		    loop (i-1)
		end
	    else ()
        (*withtype {i:int | i < n} <max(i,0)> => int(i) -> unit*)
    in
	loop (max - 1)
    end
(*withtype {n:nat} float heap(n) -> unit*)

fun print_array	(data, i, j) =
    let
	fun loop (k) =
	    if k < j then
		let
		    val _ = print_float (sub (data, k))
		in
		    loop (k+1)
		end
	    else ()
        (*withtype {k:int | i <= k <= j} <j-k> => int(k) -> unit*)
    in
	loop (i)
    end			
(*withtype {n:nat, i:int, j:int | 0 <= i <= j <= n} <j-i> =>
         float array(n) * int(i) * int(j) -> unit*)


fun main () =
    let
	val max = 16
	val data = alloc (max, 0.0)
        fun init (i) =
	    if i < max then
		let
		    val _ = update (data, i, float_of_int ((16 - i) * i))
		in
		    init (i+1)
		end
	    else ()
	(*withtype {i:nat} int(i) -> unit*)
	val _ = init (0)
    in
	heapsort (H (max, 0, data))
    end
(*withtype <> => unit -> unit*)*)
